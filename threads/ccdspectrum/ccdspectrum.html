
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2.1. Fitting a CCD spectrum &#8212; SPEX Help Center 3.06.01 documentation</title>
    <link rel="stylesheet" href="../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <script id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/language_data.js"></script>
    <link rel="canonical" href="https://spex-xray.github.io/spex-help/threads/ccdspectrum/ccdspectrum.html" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="2.2. Modeling particle background" href="../partbkg/partbkg.html" />
    <link rel="prev" title="2. Analysis threads" href="../../threads.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="section" id="fitting-a-ccd-spectrum">
<span id="sec-ccdspectrum"></span><h1><span class="section-number">2.1. </span>Fitting a CCD spectrum<a class="headerlink" href="#fitting-a-ccd-spectrum" title="Permalink to this headline">¶</a></h1>
<div class="section" id="goal">
<h2><span class="section-number">2.1.1. </span>Goal<a class="headerlink" href="#goal" title="Permalink to this headline">¶</a></h2>
<p>To load and fit a CCD spectrum (e.g. MOS1 aboard XMM-Newton) into SPEX.</p>
</div>
<div class="section" id="preparation">
<h2><span class="section-number">2.1.2. </span>Preparation<a class="headerlink" href="#preparation" title="Permalink to this headline">¶</a></h2>
<p>To be able to fit a spectrum, you need a spectrum and response file in SPEX format. To convert spectra from OGIP
format (e.g. pha, arf, rmf) to SPEX format, please use the <code class="docutils literal notranslate"><span class="pre">trafo</span></code> program like described in <a class="reference internal" href="../../getstarted/runtrafo.html#sect-runtrafo"><span class="std std-ref">How to convert spectra to SPEX format</span></a>.
If you have the <a class="reference external" href="https://github.com/spex-xray/pyspextools">Pyspextools package</a> installed, then you can use
<a class="reference external" href="https://spex-xray.github.io/pyspextools/tutorials/ogip2spex.html">ogip2spex</a> as an alternative to <code class="docutils literal notranslate"><span class="pre">trafo</span></code>.</p>
<p>Using the commands above, you can obtain a .spo and .res file containing your spectrum. To follow this thread, you
can also download example files here: <a class="reference download internal" download="" href="../../_downloads/0b78cefb1034f7e8e6922ce55e769b42/mos.spo"><code class="xref download docutils literal notranslate"><span class="pre">mos.spo</span></code></a> and <a class="reference download internal" download="" href="../../_downloads/b53723ccef774b4ed874f9554e07d788/mos.res"><code class="xref download docutils literal notranslate"><span class="pre">mos.res</span></code></a>.</p>
</div>
<div class="section" id="starting-spex">
<h2><span class="section-number">2.1.3. </span>Starting SPEX<a class="headerlink" href="#starting-spex" title="Permalink to this headline">¶</a></h2>
<p>The SPEX program is started by entering <code class="docutils literal notranslate"><span class="pre">spex</span></code> in a linux terminal window. In the following sections we describe
one run of the program. To start SPEX do this:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>user@linux:~&gt; spex
 Welcome user to SPEX version 3.06.00

SPEX&gt;
</pre></div>
</div>
<p>If SPEX does not run, please check if you set the <code class="docutils literal notranslate"><span class="pre">SPEX90</span></code> variable right and sourced <code class="docutils literal notranslate"><span class="pre">spexdist.(c)sh</span></code>
as explained in <a class="reference internal" href="../../getstarted/install.html#sec-install"><span class="std std-ref">How to install SPEX</span></a>.</p>
</div>
<div class="section" id="loading-data">
<h2><span class="section-number">2.1.4. </span>Loading data<a class="headerlink" href="#loading-data" title="Permalink to this headline">¶</a></h2>
<p>Then, we have to load the data files. This is done using the <code class="docutils literal notranslate"><span class="pre">data</span></code> command (<a class="reference internal" href="../../reference/commands/data.html#sec-data"><span class="std std-ref">Data: read response file and spectrum</span></a>). It is a general thing
in SPEX that filename extensions are not typed explicitly when issuing a command. If you have a file called
<code class="docutils literal notranslate"><span class="pre">mos.spo</span></code> and <code class="docutils literal notranslate"><span class="pre">mos.res</span></code> then you type:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>SPEX&gt; data mos mos
</pre></div>
</div>
<p>The response file (<code class="docutils literal notranslate"><span class="pre">mos.res</span></code>) is entered first and then the file containing the spectrum (<code class="docutils literal notranslate"><span class="pre">mos.spo</span></code>). You can avoid
confusion by giving the same filename to both .res and .spo files. Remember that the order of the words in the commands
is very important!</p>
</div>
<div class="section" id="plot-the-data">
<h2><span class="section-number">2.1.5. </span>Plot the data<a class="headerlink" href="#plot-the-data" title="Permalink to this headline">¶</a></h2>
<p>It really helps to see the spectrum while we are working on it, so we need a plot window and tell spex that we want
to see a plot of the data. (Note that the text after the # is a comment and should not be copied on the command line).</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>SPEX&gt; plot dev xs             # Open plot device `X server`
SPEX&gt; plot type data          # Choose the plot type `data`
SPEX&gt; plot
</pre></div>
</div>
<p>The commands above open a PGPLOT window and set the plot type to <code class="docutils literal notranslate"><span class="pre">data</span></code>, which means that the observed spectrum
and the model (folded through the response matrix) will be shown. The last <code class="docutils literal notranslate"><span class="pre">plot</span></code> command tells SPEX to
refresh the plot.</p>
<div class="figure align-default">
<a class="reference internal image-reference" href="../../_images/ccd1.png"><img alt="../../_images/ccd1.png" src="../../_images/ccd1.png" style="width: 600px;" /></a>
</div>
<p>Usually CCD spectra benefit from a logarithmic scale on both the X and Y axes:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>SPEX&gt; plot x log
SPEX&gt; plot y log
</pre></div>
</div>
<div class="figure align-default">
<a class="reference internal image-reference" href="../../_images/ccd2.png"><img alt="../../_images/ccd2.png" src="../../_images/ccd2.png" style="width: 600px;" /></a>
</div>
<p>By default, the ranges of the axes are usually too broad. For this spectrum, the X axis range is good between 0.1 and
10 keV and the Y axis range between 1E-4 and 10.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>SPEX&gt; plot rx 0.1:10.
SPEX&gt; plot ry 1E-4:10.
</pre></div>
</div>
<div class="figure align-default">
<a class="reference internal image-reference" href="../../_images/ccd3.png"><img alt="../../_images/ccd3.png" src="../../_images/ccd3.png" style="width: 600px;" /></a>
</div>
</div>
<div class="section" id="select-good-data-and-bin-the-spectrum">
<h2><span class="section-number">2.1.6. </span>Select good data and bin the spectrum<a class="headerlink" href="#select-good-data-and-bin-the-spectrum" title="Permalink to this headline">¶</a></h2>
<p>Before we start fitting, we can make sure that only trustworthy data is fitted. For MOS1, for example, we know that
the calibration is valid for the energy range between roughly 0.3 keV and 10 keV. To fit only the good spectral
interval, we need to ignore the parts at low and high energies. This is done using the <code class="docutils literal notranslate"><span class="pre">ignore</span></code> command.</p>
<p>In addition, we can bin the spectrum. To automatically rebin to the recommended (optimal) bin size, one can use
the <code class="docutils literal notranslate"><span class="pre">obin</span></code> command. This command bins the spectrum optimally based on the instrument resolution and statistics.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>SPEX&gt; ignore 0:0.3 unit kev
SPEX&gt; ignore 10:100 unit kev
SPEX&gt; obin 0.3:10 unit kev
SPEX&gt; plot
</pre></div>
</div>
<div class="figure align-default">
<a class="reference internal image-reference" href="../../_images/ccd4.png"><img alt="../../_images/ccd4.png" src="../../_images/ccd4.png" style="width: 600px;" /></a>
</div>
</div>
<div class="section" id="define-the-model">
<h2><span class="section-number">2.1.7. </span>Define the model<a class="headerlink" href="#define-the-model" title="Permalink to this headline">¶</a></h2>
<p>Next we can define the model that we want to fit. In this case, we are looking at a MOS spectrum of a
galaxy cluster. The simplest model that we can try is a single temperature spectrum absorbed by gas in
the ISM. We also add a redshift component <code class="docutils literal notranslate"><span class="pre">reds</span></code> (<a class="reference internal" href="../../models/reds.html#sect-reds"><span class="std std-ref">Reds: redshift model</span></a>) to shift the energy of the model
spectrum with the right amount:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>SPEX&gt; com reds
You have defined    1 component.
SPEX&gt; com hot
You have defined    2 components.
SPEX&gt; com cie
You have defined    3 components.
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">hot</span></code> model (<a class="reference internal" href="../../models/hot.html#sect-hot"><span class="std std-ref">Hot: collisional ionisation equilibrium absorption model</span></a>) is actually a gas in equilibrium in absorption, which is a fair representation of
the neutral gas phase of the ISM. Later we will put the temperature of this component to <img class="math" src="../../_images/math/6f33adba9d23db12b19748eeb0244a7b99e8bd9a.svg" alt="5 \times 10^{-4}" style="vertical-align: -1px"/> keV
to emulate a neutral plasma.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">cie</span></code> model (<a class="reference internal" href="../../models/cie.html#sect-cie"><span class="std std-ref">Cie: collisional ionisation equilibrium model</span></a>) represents a single temperature plasma in collisional ionisation equilibrium,
which is commonly used for clusters.</p>
<p>Then the components need to be related to each other, which means you need to specify how the multiplicative models
should be applied to the additive models. The multiplicative components should be listed in order from the source to
the observer (see also <a class="reference internal" href="../../reference/commands/component.html#sec-comp"><span class="std std-ref">Comp: create, delete and relate spectral components</span></a>):</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>SPEX&gt; com rel 3 1,2
</pre></div>
</div>
<p>This means that the emitted CIE component (#3) will be first redshifted by component #1 and then absorbed by component
#2. If you have multiple additive components, this should be done for each one. It is possible to supply a range of
components.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>SPEX&gt; calc
SPEX&gt; plot
</pre></div>
</div>
<p>Calculating and plotting the model unsurprisingly results in a curve that is not near to the data.</p>
<div class="figure align-default">
<a class="reference internal image-reference" href="../../_images/ccd5.png"><img alt="../../_images/ccd5.png" src="../../_images/ccd5.png" style="width: 600px;" /></a>
</div>
</div>
<div class="section" id="initial-guess-of-parameters">
<h2><span class="section-number">2.1.8. </span>Initial guess of parameters<a class="headerlink" href="#initial-guess-of-parameters" title="Permalink to this headline">¶</a></h2>
<p>To help the spectral fitting process, it is good to provide initial guesses for the model parameters. This way, the
spectral fit starts already with a model that is in the right direction. As a more experienced user, you usually have
a rough idea what the parameters should be by looking at the raw spectrum. For this cluster, for example, the
redshift is around 0.05, the absorption column is small, and the temperature of the cluster is around 3 keV.
We can set the guess parameters as follows:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>SPEX&gt; par 1 1 z v 0.05
SPEX&gt; par 1 1 z s t
SPEX&gt; par 1 2 t v 8E-6
SPEX&gt; par 1 2 t s f
SPEX&gt; par 1 2 nh v 1E-4
SPEX&gt; par 1 3 norm v 1000.
SPEX&gt; par 1 3 t v 3.0
SPEX&gt; ca
SPEX&gt; pl
</pre></div>
</div>
<div class="figure align-default">
<a class="reference internal image-reference" href="../../_images/ccd6.png"><img alt="../../_images/ccd6.png" src="../../_images/ccd6.png" style="width: 600px;" /></a>
</div>
<p>As we can see from the image, the first guess of the model is already in the right direction.</p>
<p>In this example, we assume that the exact redshift is unknown. However, if you do have an accurate measurement of
the distance, it is wise to set that distance in SPEX (<a class="reference internal" href="../../reference/commands/distance.html#sec-distance"><span class="std std-ref">Distance: set the source distance</span></a>):</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>SPEX&gt; dist 0.05 z
</pre></div>
</div>
<p>The command above sets the distance to 0.05 z and makes sure that the luminosities are correctly calculated.
Note that this distance change also affects the values of the normalisation of the models! So, we increase
the normalisation to keep the model reasonably close to the data:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>SPEX&gt; par 1 3 norm v 1E+8
</pre></div>
</div>
</div>
<div class="section" id="fit-the-model">
<h2><span class="section-number">2.1.9. </span>Fit the model<a class="headerlink" href="#fit-the-model" title="Permalink to this headline">¶</a></h2>
<p>We are now ready to fit the spectrum. To see the fitting steps, we can give the command <code class="docutils literal notranslate"><span class="pre">fit</span> <span class="pre">print</span> <span class="pre">1</span></code>. This needs
to be set only once per session. A subsequent <code class="docutils literal notranslate"><span class="pre">fit</span></code> command (<a class="reference internal" href="../../reference/commands/fit.html#sec-fit"><span class="std std-ref">Fit: spectral fitting</span></a>) starts to optimize the parameters:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>SPEX&gt; fit print 1
SPEX&gt; fit
   42102.6              5  5.000E-02  1.000E-04  1.000E+08   3.00
   2461.87             10  5.404E-02  9.087E-05  2.021E+08   2.04
   428.533             15  5.439E-02  1.041E-04  2.412E+08   2.31
   414.925             20  5.437E-02  9.425E-05  2.429E+08   2.37
   414.651             25  5.426E-02  9.229E-05  2.428E+08   2.37
   414.532             30  5.408E-02  9.269E-05  2.428E+08   2.37
   414.525             35  5.412E-02  9.281E-05  2.428E+08   2.37
   414.524             42  5.411E-02  9.270E-05  2.428E+08   2.37
   414.524             48  5.411E-02  9.265E-05  2.428E+08   2.37
--------------------------------------------------------------------------------------------------
sect comp mod  acro parameter with unit     value      status    minimum   maximum lsec lcom lpar

   1    1 reds z    Redshift             5.4108180E-02 thawn    -1.0      1.00E+10
   1    1 reds flag Flag: cosmo=0, vel=1  0.000000     frozen    0.0       1.0

   1    2 hot  nh   X-Column (1E28/m**2) 9.2653019E-05 thawn     0.0      1.00E+20
   1    2 hot  t    Temperature (keV)    1.9999999E-04 frozen   2.00E-04  1.00E+03
   1    2 hot  rt   T(balance) / T(spec)  1.000000     frozen   1.00E-04  1.00E+04
   1    2 hot  fcov Covering fraction     1.000000     frozen    0.0       1.0
   1    2 hot  v    RMS Velocity (km/s)   100.0000     frozen    0.0      3.00E+05
   1    2 hot  rms  RMS blend    (km/s)   0.000000     frozen    0.0      1.00E+05
   1    2 hot  dv   Vel. separ. (km/s)    100.0000     frozen    0.0      1.00E+05
   1    2 hot  zv   Average vel. (km/s)   0.000000     frozen  -1.00E+05  1.00E+05
   1    2 hot  ref  Reference atom        1.000000     frozen    1.0       30.
   1    2 hot  01   Abundance H           1.000000     frozen    0.0      1.00E+10
   1    2 hot  02   Abundance He          1.000000     frozen    0.0      1.00E+10
   1    2 hot  03   Abundance Li          1.000000     frozen    0.0      1.00E+10
   1    2 hot  04   Abundance Be          1.000000     frozen    0.0      1.00E+10
   1    2 hot  05   Abundance B           1.000000     frozen    0.0      1.00E+10
   1    2 hot  06   Abundance C           1.000000     frozen    0.0      1.00E+10
   1    2 hot  07   Abundance N           1.000000     frozen    0.0      1.00E+10
   1    2 hot  08   Abundance O           1.000000     frozen    0.0      1.00E+10
   1    2 hot  09   Abundance F           1.000000     frozen    0.0      1.00E+10
   1    2 hot  10   Abundance Ne          1.000000     frozen    0.0      1.00E+10
   1    2 hot  11   Abundance Na          1.000000     frozen    0.0      1.00E+10
   1    2 hot  12   Abundance Mg          1.000000     frozen    0.0      1.00E+10
   1    2 hot  13   Abundance Al          1.000000     frozen    0.0      1.00E+10
   1    2 hot  14   Abundance Si          1.000000     frozen    0.0      1.00E+10
   1    2 hot  15   Abundance P           1.000000     frozen    0.0      1.00E+10
   1    2 hot  16   Abundance S           1.000000     frozen    0.0      1.00E+10
   1    2 hot  17   Abundance Cl          1.000000     frozen    0.0      1.00E+10
   1    2 hot  18   Abundance Ar          1.000000     frozen    0.0      1.00E+10
   1    2 hot  19   Abundance K           1.000000     frozen    0.0      1.00E+10
   1    2 hot  20   Abundance Ca          1.000000     frozen    0.0      1.00E+10
   1    2 hot  21   Abundance Sc          1.000000     frozen    0.0      1.00E+10
   1    2 hot  22   Abundance Ti          1.000000     frozen    0.0      1.00E+10
   1    2 hot  23   Abundance V           1.000000     frozen    0.0      1.00E+10
   1    2 hot  24   Abundance Cr          1.000000     frozen    0.0      1.00E+10
   1    2 hot  25   Abundance Mn          1.000000     frozen    0.0      1.00E+10
   1    2 hot  26   Abundance Fe          1.000000     frozen    0.0      1.00E+10
   1    2 hot  27   Abundance Co          1.000000     frozen    0.0      1.00E+10
   1    2 hot  28   Abundance Ni          1.000000     frozen    0.0      1.00E+10
   1    2 hot  29   Abundance Cu          1.000000     frozen    0.0      1.00E+10
   1    2 hot  30   Abundance Zn          1.000000     frozen    0.0      1.00E+10
   1    2 hot  file File electr.distrib.

   1    3 cie  norm ne nX V (1E64/m**3)  2.4279381E+08 thawn     0.0      1.00E+20
   1    3 cie  t    Temperature (keV)     2.372914     thawn    5.00E-04  1.00E+03
   1    3 cie  sig  Sigma                 0.000000     frozen    0.0      1.00E+04
   1    3 cie  sup  Sigma up              0.000000     frozen    0.0      1.00E+04
   1    3 cie  logt T grid (lin/log)      1.000000     frozen    0.0       1.0
   1    3 cie  ed   El  dens (1E20/m**3) 9.9999998E-15 frozen   1.00E-22  1.00E+10
   1    3 cie  it   Ion temp  (keV)       1.000000     frozen   1.00E-04  1.00E+07
   1    3 cie  rt   T(balance) / T(spec)  1.000000     frozen   1.00E-04  1.00E+04
   1    3 cie  vrms RMS Velocity (km/s)   0.000000     frozen    0.0      3.00E+05
   1    3 cie  ref  Reference atom        1.000000     frozen    1.0       30.
   1    3 cie  01   Abundance H           1.000000     frozen    0.0      1.00E+10
   1    3 cie  02   Abundance He          1.000000     frozen    0.0      1.00E+10
   1    3 cie  03   Abundance Li          1.000000     frozen    0.0      1.00E+10
   1    3 cie  04   Abundance Be          1.000000     frozen    0.0      1.00E+10
   1    3 cie  05   Abundance B           1.000000     frozen    0.0      1.00E+10
   1    3 cie  06   Abundance C           1.000000     frozen    0.0      1.00E+10
   1    3 cie  07   Abundance N           1.000000     frozen    0.0      1.00E+10
   1    3 cie  08   Abundance O           1.000000     frozen    0.0      1.00E+10
   1    3 cie  09   Abundance F           1.000000     frozen    0.0      1.00E+10
   1    3 cie  10   Abundance Ne          1.000000     frozen    0.0      1.00E+10
   1    3 cie  11   Abundance Na          1.000000     frozen    0.0      1.00E+10
   1    3 cie  12   Abundance Mg          1.000000     frozen    0.0      1.00E+10
   1    3 cie  13   Abundance Al          1.000000     frozen    0.0      1.00E+10
   1    3 cie  14   Abundance Si          1.000000     frozen    0.0      1.00E+10
   1    3 cie  15   Abundance P           1.000000     frozen    0.0      1.00E+10
   1    3 cie  16   Abundance S           1.000000     frozen    0.0      1.00E+10
   1    3 cie  17   Abundance Cl          1.000000     frozen    0.0      1.00E+10
   1    3 cie  18   Abundance Ar          1.000000     frozen    0.0      1.00E+10
   1    3 cie  19   Abundance K           1.000000     frozen    0.0      1.00E+10
   1    3 cie  20   Abundance Ca          1.000000     frozen    0.0      1.00E+10
   1    3 cie  21   Abundance Sc          1.000000     frozen    0.0      1.00E+10
   1    3 cie  22   Abundance Ti          1.000000     frozen    0.0      1.00E+10
   1    3 cie  23   Abundance V           1.000000     frozen    0.0      1.00E+10
   1    3 cie  24   Abundance Cr          1.000000     frozen    0.0      1.00E+10
   1    3 cie  25   Abundance Mn          1.000000     frozen    0.0      1.00E+10
   1    3 cie  26   Abundance Fe          1.000000     frozen    0.0      1.00E+10
   1    3 cie  27   Abundance Co          1.000000     frozen    0.0      1.00E+10
   1    3 cie  28   Abundance Ni          1.000000     frozen    0.0      1.00E+10
   1    3 cie  29   Abundance Cu          1.000000     frozen    0.0      1.00E+10
   1    3 cie  30   Abundance Zn          1.000000     frozen    0.0      1.00E+10
   1    3 cie  file File electr.distrib.
   1    3 cie  x1   T1/T0                 1.000000     frozen    1.0      1.00E+10
   1    3 cie  y1   N1/N0                 0.000000     frozen    0.0      1.00E+10


Instrument     1 region    1 has norm    1.00000E+00 and is frozen

--------------------------------------------------------------------------------
 Fluxes and restframe luminosities between   2.0000     and    10.000     keV

 sect comp mod   photon flux   energy flux nr of photons    luminosity
              (phot/m**2/s)      (W/m**2)   (photons/s)           (W)
    1    3 cie    4.13667      2.229383E-15  2.655905E+51  1.422295E+36

--------------------------------------------------------------------------------
 Fit method        : Classical Levenberg-Marquardt
 Fit statistic     : C-statistic
 C-statistic       :       414.52
 Expected C-stat   :       247.13 +/-        21.92
 Chi-squared value :       528.16
 Degrees of freedom:       239
 W-statistic       :         0.00
</pre></div>
</div>
<p>At the end of the optimization step, SPEX prints out an overview of the fit parameters and the fit statistics. Here we
can see that the fit improved, but there is still room for improvement.</p>
<div class="figure align-default">
<a class="reference internal image-reference" href="../../_images/ccd7.png"><img alt="../../_images/ccd7.png" src="../../_images/ccd7.png" style="width: 600px;" /></a>
</div>
</div>
<div class="section" id="fitting-abundances">
<h2><span class="section-number">2.1.10. </span>Fitting abundances<a class="headerlink" href="#fitting-abundances" title="Permalink to this headline">¶</a></h2>
<p>Although the C-statistics are not too bad, there are still residuals in the spectrum, especially around the strongest
spectral lines. This is because the metal abundances in the gas are still fixed to 1.0. We can let the abundances vary
in the optimization by setting them to thawn:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>SPEX&gt; par 1 3 08 s t
SPEX&gt; par 1 3 12 s t
SPEX&gt; par 1 3 14 s t
SPEX&gt; par 1 3 16 s t
SPEX&gt; par 1 3 18 s t
SPEX&gt; par 1 3 20 s t
SPEX&gt; par 1 3 26 s t
SPEX&gt; par 1 3 28 s t
SPEX&gt; fit
</pre></div>
</div>
<p>The optimization leads to an even better fit:</p>
<div class="figure align-default">
<a class="reference internal image-reference" href="../../_images/ccd8.png"><img alt="../../_images/ccd8.png" src="../../_images/ccd8.png" style="width: 600px;" /></a>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Fit method        : Classical Levenberg-Marquardt
Fit statistic     : C-statistic
C-statistic       :       266.80
Expected C-stat   :       247.12 +/-        21.91
Chi-squared value :       366.77
Degrees of freedom:       231
W-statistic       :         0.00
</pre></div>
</div>
</div>
<div class="section" id="calculating-errors">
<h2><span class="section-number">2.1.11. </span>Calculating errors<a class="headerlink" href="#calculating-errors" title="Permalink to this headline">¶</a></h2>
<p>When we have the best fit, we can calculate the errors (<a class="reference internal" href="../../reference/commands/error.html#sec-error"><span class="std std-ref">Error: Calculate the errors of the fitted parameters</span></a>). This has to be done per parameter.
Below we calculate, for example, the error on the best fit temperature:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>SPEX&gt; error 1 3 t
 parameter          C-stat      Delta          Delta
   value            value       parameter     C-stat
----------------------------------------------------
   2.33348          267.68     -2.246547E-02    0.89
   2.31101          270.23     -4.493093E-02    3.44
   2.33348          267.68     -2.246547E-02    0.89
   2.33247          267.69     -2.346587E-02    0.90
   2.32425          268.52     -3.169394E-02    1.73
   2.32836          268.05     -2.758002E-02    1.26
   2.33042          267.87     -2.552295E-02    1.07
   2.33127          267.79     -2.466774E-02    1.00
   2.37841          267.71      2.246547E-02    0.92
   2.40087          270.28      4.493093E-02    3.49
   2.37841          267.71      2.246547E-02    0.92
   2.37914          267.77      2.319646E-02    0.98
   2.37940          267.78      2.345586E-02    0.99
   2.37974          267.81      2.379751E-02    1.02
 Parameter   1    3 t   :    2.3559     Errors:  -2.46677E-02 ,   2.37975E-02
</pre></div>
</div>
<p>The error command reports the best fit value for the temperature and the lower and upper 1 sigma (68%) confidence
level.</p>
<p>Usually, the error calculation stage is the end point of a spectral analysis. In this example,
we can quit SPEX now:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>SPEX&gt; quit
Thank you for using SPEX!
</pre></div>
</div>
</div>
</div>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<p class="logo">
  <a href="../../index.html">
    <img class="logo" src="../../_static/logo-wide.png" alt="Logo"/>
    
  </a>
</p>








<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../getstarted.html">1. Getting started</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../threads.html">2. Analysis threads</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">2.1. Fitting a CCD spectrum</a></li>
<li class="toctree-l2"><a class="reference internal" href="../partbkg/partbkg.html">2.2. Modeling particle background</a></li>
<li class="toctree-l2"><a class="reference internal" href="../amol/amol.html">2.3. Fitting interstellar dust absorption</a></li>
<li class="toctree-l2"><a class="reference internal" href="../uv.html">2.4. Import UV/Optical data</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pionabs/pionabs.html">2.5. PION setup for AGN warm absorber</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pionena/pionena.html">2.6. PION setup for emission and absorption features in AGN</a></li>
<li class="toctree-l2"><a class="reference internal" href="../twospec/twospec.html">2.7. Fitting two different spectra simultaneously</a></li>
<li class="toctree-l2"><a class="reference internal" href="../user/user.html">2.8. How to use the SPEX user model</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../reference.html">3. Command overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../models.html">4. Spectral models</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tools.html">5. Additional tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../pyspex.html">6. Python Interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../help.html">7. Help &amp; troubleshooting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../theory.html">8. SPEX Theory</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../exercises.html">9. Exercises</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../changelog.html">10. Changelog</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../credits.html">11. Credits</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../index.html">Documentation overview</a><ul>
  <li><a href="../../threads.html"><span class="section-number">2. </span>Analysis threads</a><ul>
      <li>Previous: <a href="../../threads.html" title="previous chapter"><span class="section-number">2. </span>Analysis threads</a></li>
      <li>Next: <a href="../partbkg/partbkg.html" title="next chapter"><span class="section-number">2.2. </span>Modeling particle background</a></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
<div class="footer">
        Last updated on: Apr 14, 2021.<br>
    
        &copy;2020, Jelle de Plaa, Jelle Kaastra, SPEX Development Team, <a href="https://www.sron.nl/">SRON Netherlands Institute for Space Research</a>.
    

</div>

  </body>
</html>

<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>4.1.27. Musr: User defined multiplicative model &#8212; SPEX Help Center 3.07.02 documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/alabaster.css" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <link rel="canonical" href="https://spex-xray.github.io/spex-help/models/musr.html" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="4.1.28. Neij: non-equilibrium ionisation jump model" href="neij.html" />
    <link rel="prev" title="4.1.26. Mbb: modified blackbody model" href="mbb.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="musr-user-defined-multiplicative-model">
<span id="sect-musr"></span><h1><span class="section-number">4.1.27. </span>Musr: User defined multiplicative model<a class="headerlink" href="#musr-user-defined-multiplicative-model" title="Permalink to this headline">¶</a></h1>
<p>The user model provides an interface to create an multiplicative model
component calculated by a user program. The interface is rather simple
and therefore very flexible. The interface uses a set of two ASCII
files: <code class="docutils literal notranslate"><span class="pre">input-?-?.prm</span></code> and <code class="docutils literal notranslate"><span class="pre">output-?-?.spc</span></code>, where the ’?’ stands for the
sector and component number of the musr model component.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">input-?-?.prm</span></code> is generated by the musr model and contains the
parameter values and the energy grid that SPEX uses to calculate the
model. The file has a fixed structure:</p>
<ul class="simple">
<li><p>The first line contains one integer number containing the number of
parameters that the model needs to calculate (current maximum is 40).</p></li>
<li><p>On the second line the array of parameter values is listed (with the
length indicated on the previous line.</p></li>
<li><p>On the third line, an integer value is shown which indicates the
number of model bins SPEX has in its model grid.</p></li>
<li><p>On the following lines, the model grid points are shown in three
columns. The first column contains the bin upper boundary (egb), the
second column is the bin center (eg) and the third column is the full
bin width (deg). The energy values are in keV.</p></li>
</ul>
<p>The user program is supposed to read the input file and calculate the
multiplicative factors for each energy bin on the grid. The spectrum
array is called <code class="docutils literal notranslate"><span class="pre">sener</span></code> and has the same length as the energy grid. In
addition, it is also possible to calculate the model for the emission
weighted center of the bin. In that case the spectrum calculation is a
bit more complicated, but it leads to better results. The user has the
option of also calculating the weighted spectrum, which is the average
photon energy <img class="math" src="../_images/math/8e9ae3dec0e18e1570cfda5baa3c64ce2c3866a4.svg" alt="E_{\mathrm{aver}}" style="vertical-align: -2px"/> minus the bin centroid
<img class="math" src="../_images/math/3ca21ca0ce66580447a6b6080dc52306f6cf26c9.svg" alt="E_{\mathrm{centroid}}" style="vertical-align: -2px"/> times the flux (F):</p>
<div class="math">
<p><img src="../_images/math/d1cd045500ca62f34639d0541856787461d40b7d.svg" alt="W = (E_{\mathrm{aver}} - E_{\mathrm{centroid}}) * F"/></p>
</div><p>The <img class="math" src="../_images/math/b8176ea3f9cd37ef8a7d22fa52dfbee689b1b823.svg" alt="W" style="vertical-align: 0px"/> values end up in the <code class="docutils literal notranslate"><span class="pre">wener</span></code> array. If you do not use
weighing by average photon energy, <code class="docutils literal notranslate"><span class="pre">wener</span></code> values can be 0.</p>
<p>The user program should create an output ASCII file named <code class="docutils literal notranslate"><span class="pre">output-?-?.spc</span></code>
with the following structure:</p>
<ul class="simple">
<li><p>On the first row, put the number of model bins. This should be the
same number as written in the <code class="docutils literal notranslate"><span class="pre">input-?-?.prm</span></code> file.</p></li>
<li><p>Write the <code class="docutils literal notranslate"><span class="pre">sener</span></code> and <code class="docutils literal notranslate"><span class="pre">wener</span></code> values in two columns. The first column
is the <code class="docutils literal notranslate"><span class="pre">sener</span></code> value that represents the multiplication factor and
the second column is the <code class="docutils literal notranslate"><span class="pre">wener</span></code> value.</p></li>
</ul>
<p>In <a class="reference internal" href="../threads/user/user.html#sect-howtouser"><span class="std std-ref">How to use the SPEX user model</span></a> some example user
model programs can be found. The source code can be adapted to
accommodate the user’s wishes.</p>
<p>The equivalent of <code class="docutils literal notranslate"><span class="pre">musr</span></code> for additive models is <a class="reference internal" href="user.html#sect-user"><span class="std std-ref">User: User defined model</span></a>.</p>
<p>The parameters of the model are:</p>
<div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">exec</span></code> : User executable, for example ’./model.py’ for a python
script in the same directory where you run SPEX.</div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">npar</span></code> : Number of free parameters in the model. Current maximum is
40.</div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">p01...p40</span></code> : Model parameters of the user model.</div>
</div>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<p class="logo">
  <a href="../index.html">
    <img class="logo" src="../_static/logo-wide.png" alt="Logo"/>
    
  </a>
</p>








<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../getstarted.html">1. Getting started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../threads.html">2. Analysis threads</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference.html">3. Command overview</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../models.html">4. Spectral models</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="over.html">4.1. Overview of spectral components</a></li>
<li class="toctree-l2"><a class="reference internal" href="performance.html">4.2. Optimizing model performance</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../tools.html">5. Additional tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pyspex.html">6. Python Interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../help.html">7. Help &amp; troubleshooting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../theory.html">8. SPEX Theory</a></li>
<li class="toctree-l1"><a class="reference internal" href="../exercises.html">9. Exercises</a></li>
<li class="toctree-l1"><a class="reference internal" href="../changelog.html">10. Changelog</a></li>
<li class="toctree-l1"><a class="reference internal" href="../credits.html">11. Credits</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  <li><a href="../models.html"><span class="section-number">4. </span>Spectral models</a><ul>
  <li><a href="over.html"><span class="section-number">4.1. </span>Overview of spectral components</a><ul>
      <li>Previous: <a href="mbb.html" title="previous chapter"><span class="section-number">4.1.26. </span>Mbb: modified blackbody model</a></li>
      <li>Next: <a href="neij.html" title="next chapter"><span class="section-number">4.1.28. </span>Neij: non-equilibrium ionisation jump model</a></li>
  </ul></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
<div class="footer">
        Last updated on: Nov 29, 2022.<br>
    
        &copy;2022, Jelle de Plaa, Jelle Kaastra, Liyi Gu, SPEX Development Team, <a href="https://www.sron.nl/">SRON Netherlands Institute for Space Research</a>.
    

</div>

  </body>
</html>